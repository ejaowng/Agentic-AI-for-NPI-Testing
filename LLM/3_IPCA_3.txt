// Save CV -- change config -- recover
// General prompt requirement
First, we describe the query requirements for all following queries: The rule should be written in SWI-Prolog format. Please keep the rules simple. Provide each command with all required parameters (not just the command itself). Output only the SWI-Prolog code - no explanations or comments. At the end, please include the directive to execute all the rules so that the generated code can be directly run in a Prolog tool. We already have external builtin predicates, please use only the available MOs, Attributes, and instruction (or predicate) lists — do not introduce others or declare them as dynamic. Make sure to follow the defined instruction inputs and respect the comments provided for each MO, Attribute, and instruction. Do not include any markdown code fences or formatting (such as prolog or ). The code should appear as plain text only. This information is for reference only and will be used later in the final query step so no action now. 


// Check License MB/LB
In the previous prompt, we already selected the MB and LB cells for the IPCA test. The assigned MB cell name is 'DL10DUCell1'. First, we want to retrieve the cell's IP address, which will be used for the instructions in the rules below. Then, using the MB NR DU cell's IP address, we want to check the IPCA-related license for the MB cell, and if it is not enabled, enable it. The assigned LB cell name is 'MSRBS1170LBDUCell1'. First, we want to retrieve the cell's IP address, which will be used for the instructions in the rules below. Then, using the LB NR DU cell's IP address, we want to check the IPCA-related license for the LB cell, and if it is not enabled, enable it. Call the directive at end ipca_licence.


// VLAN Port 
Step I: In the previous prompt, we already selected the MB and LB cells for the IPCA test. The assigned MB cell name is ‘DL10DUCell1’. We now want to check the VLAN port related to the MB cell. First, we need to find the cell’s IP address, which will be used for the instructions in the following rules. Then, from the cell name, first find cell ID, then find the corresponding DU function, then retrieve the VLAN port ID for Carrier Aggregation (CA) and store it as Cavlan, and retrieve the VLAN port ID for OAM and store it as Oamvlan. Generate one concise and executable rule for this step but no execution.

Step II: With cell IP and Oamvlan from Step I, We then find the VLAN port for OAM, with the following steps: For all VLAN ports, check whether any VLAN port uses VLAN ID Oamvlan; keep this VLAN port as ‘V_Oam’. For this VLAN port, retrieve its underlying Ethernet port using encapsulation and keep it as ‘E_Oam’. Then retrieve its underlying TN port and keep it as ‘T_Oam’. Generate one concise and executable rule for this step but no execution.

Step III: With inputs from Step I and II, for all VLAN ports, first check whether any VLAN port uses VLAN ID Cavlan. If the VLAN port using VLAN ID Cavlan is found (refer as 'V_CA'), retrieve its underlying Ethernet port (call it ‘E_CA’) via encapsulation, and verify whether that Ethernet port is encapsulated with a TN port whose ID begins with ‘TN_’, but is not ‘T_Oam’. If yes, deblock the Ethernet port. If not, a TN port needs to be encapsulated, then the Ethernet port is deblocked. To encapsulate a TN port to the Ethernet port, retrieve all Field Replaceable Units. For the Field Replaceable Unit whose name begins with ‘VDUxx’ ('xx' can be any character, use prefix), refer to it as ‘F’. Next, retrieve all TN ports and locate one whose ID starts with ‘TN_’ but is not ‘T_Oam’. If such a TN port does not exist, create a new one using the FRU ID of ‘F’ (The newly created TN port may use either ‘TN_A’ or ‘TN_B’ as its ID, but it must not use the same ID as T_Oam.). This TN port - whether it is found or newly created - will be referred to as ‘T_CA’. After assigning the ID, encapsulate T_CA to the Ethernet port ‘E_CA’. Generate concise and executable rule for this step but no execution. 

Step IV: With inputs from Step I and II, For all VLAN ports, first check whether any VLAN port uses VLAN ID Cavlan. If none, follow the three steps below to create a new VLAN port. This information is for reference only and will be used later so no action now.

Step 1: retrieve all Field Replaceable Units. For the Field Replaceable Unit whose name begins with ‘VDUxx’ ('xx' can be any character, use prefix), refer to it as ‘F’. Next, retrieve all TN ports and locate one whose ID starts with ‘TN_’ but is not ‘T_Oam’. If such a TN port does not exist, create a new one using the FRU ID of ‘F’ (The newly created TN port may use either ‘TN_A’ or ‘TN_B’ as its ID, but it must not use the same ID as T_Oam.). This TN port - whether it is found or newly created - will be referred to as ‘T_CA’. This information is for reference only and will be used later so no action now. Step 2: For all Ethernet port MOs, retrieve their underlying TN ports. Check whether any Ethernet port uses encapsulation with TN port ‘T_CA’. If none exist, create an Ethernet port referencing the TN port. The Ethernet port found or created should be referred to as ‘E_CA’. This information is for reference only and will be used later so no action now. Step 3: For all VLAN ports, retrieve their underlying Ethernet port. Check whether any VLAN port uses encapsulation with Ethernet port ‘E_CA’ and has VLAN ID Cavlan. If none exist, create a VLAN port MO with VLAN ID Cavlan, referencing Ethernet port ‘E_CA’ and deblock the Ethernet port. The VLAN port found or created should be returned as a variable ('V_CA'). Finally, please generate SWI-Prolog code for all above step 1 to step 3 but no execution. 

Step V: For the MB cell ‘DL10DUCell1’, obtain its IP address and cell ID, then obtain its DU Function and configurate its reference to the VLAN Port to 'V_CA'. Generate one concise and executable rule for this step but no execution.

Finally, please integrate Step I to Step V and generate SWI-Prolog code. Please also add a final directive that runs all rules together so the code can be executed in a Prolog tool. Please provide only the code output itself, without any explanations or formatting indicators. Call the directive at end mb_vlanport_check_create.

// LB
Step I: In the previous prompt, we already selected the MB and LB cells for the IPCA test. The assigned LB cell name is ‘MSRBS1170LBDUCell1’. We now want to check the VLAN port related to the LB cell. First, we need to find the cell’s IP address, which will be used for the instructions in the following rules. Then, from the cell name, first find cell ID, then find the corresponding DU function, then retrieve the VLAN port ID for Carrier Aggregation (CA) and store it as Cavlan, and retrieve the VLAN port ID for OAM and store it as Oamvlan. Generate one concise and executable rule for this step but no execution.

Step II: With cell IP and Oamvlan from Step I, We then find the VLAN port for OAM, with the following steps: For all VLAN ports, check whether any VLAN port uses VLAN ID Oamvlan; keep this VLAN port as ‘V_Oam’. For this VLAN port, retrieve its underlying Ethernet port using encapsulation and keep it as ‘E_Oam’. Then retrieve its underlying TN port and keep it as ‘T_Oam’. Generate one concise and executable rule for this step but no execution.

Step III: With inputs from Step I and II, for all VLAN ports, first check whether any VLAN port uses VLAN ID Cavlan. If the VLAN port using VLAN ID Cavlan is found (refer as 'V_CA'), retrieve its underlying Ethernet port (call it ‘E_CA’) via encapsulation, and verify whether that Ethernet port is encapsulated with a TN port whose ID begins with ‘TN_IDL_’. If yes, deblock the Ethernet port. If not, a TN port needs to be encapsulated, then the Ethernet port is deblocked. To encapsulate a TN port to the Ethernet port, retrieve all Field Replaceable Units. For the Field Replaceable Unit whose name begins with ‘BBxx’ ('xx' can be any character, use prefix), refer to it as ‘F’. Next, retrieve all TN ports and locate one whose ID starts with ‘TN_IDL_’ but is not ‘T_Oam’. If such a TN port does not exist, create a new one using the FRU ID of ‘F’ (The newly created TN port may use TN_IDL_xxx as its ID, where 'xxx' can be 'A', 'B', 'C', 'D', but it must not use the same ID as T_Oam). This TN port - whether it is found or newly created - will be referred to as ‘T_CA’. After assigning the ID, encapsulate T_CA to the Ethernet port ‘E_CA’. Generate concise and executable rule for this step but no execution. 

Step IV: With inputs from Step I and II, For all VLAN ports, first check whether any VLAN port uses VLAN ID Cavlan. If none, follow the three steps below to create a new VLAN port. This information is for reference only and will be used later so no action now.

Step 1: retrieve all Field Replaceable Units. For the Field Replaceable Unit whose name begins with ‘BBxx’ ('xx' can be any character, use prefix), refer to it as ‘F’. Next, retrieve all TN ports and locate one whose ID starts with ‘TN_IDL_’ but is not ‘T_Oam’. If such a TN port does not exist, create a new one using the FRU ID of ‘F’ (The newly created TN port may use TN_IDL_xxx as its ID, where 'xxx' can be 'A', 'B', 'C', 'D', but it must not use the same ID as T_Oam). This TN port - whether it is found or newly created - will be referred to as ‘T_CA’. This information is for reference only and will be used later so no action now.

Step 2: For all Ethernet port MOs, retrieve their underlying TN ports. Check whether any Ethernet port uses encapsulation with TN port ‘T_CA’. If none exist, create an Ethernet port referencing the TN port. The Ethernet port found or created should be referred to as ‘E_CA’. This information is for reference only and will be used later so no action now.

Step 3: For all VLAN ports, retrieve their underlying Ethernet port. Check whether any VLAN port uses encapsulation with Ethernet port ‘E_CA’ and has VLAN ID Cavlan. If none exist, create a VLAN port MO with VLAN ID Cavlan, referencing Ethernet port ‘E_CA’ and deblock the Ethernet port. The VLAN port found or created should be returned as a variable ('V_CA'). Finally, please generate SWI-Prolog code for all above step 1 to step 3 but no execution. 

Step V: For the LB cell ‘MSRBS1170LBDUCell1’, obtain its IP address and cell ID, then obtain its DU Function and configurate its reference to the VLAN Port to 'V_CA'. Generate one concise and executable rule for this step but no execution.

Finally, please integrate Step I to Step V and generate SWI-Prolog code. The output should be in executable form, concise, and without extra explanation. Please also add a final directive that runs all rules together so the code can be executed in a Prolog tool. Please provide only the code output itself, without any explanations or formatting indicators. Call the directive at end lb_vlanport_check_create.


// Check MB -> LB conn.
We have a known source NR DU cell (DL10DUCell1) and a known target NR DU cell (MSRBS1170LBDUCell1). For the target NR DU cell, first obtain its IP address, then retrieve its cell ID, and finally obtain its gNBId (the target gNBId). For the source NR DU cell, obtain its IP address, then retrieve the gNodeBId values of all External GNB CUCP Functions and check whether any matches the known target gNBId. If none exists, create a new External GNB CUCP Function. Please generate a concise SWI-Prolog rule to perform this procedure. Include a directive at the end so that all rules are executed automatically when loaded in a Prolog environment. Name the directive at end check_create_ExtCUCPF.

We have a known source NR DU cell (DL10DUCell1) and a known target NR DU cell (MSRBS1170LBDUCell1). For the target NR DU cell, first obtain its IP address, then retrieve its cell ID. Next, obtain the corresponding DU Function and from that DU Function retrieve the predefined IPv6 backhaul address. Finally, obtain its gNBId (the target gNBId). For the source NR DU cell, obtain its IP address, then retrieve the gNodeBId values of all External GNB CUCP Functions and check whether any matches the target gNBId. If a matching External GNB CUCP Function is found, retrieve the associated TermPointToGNodeB. If no TermPoint exists, create one for that External GNB CUCP Function, assign the IPv6 address, and enable it. If a TermPoint already exists, assign the IPv6 address and enable (set to '1') it. Finally, verify the IPv6 address in the TermPointToGNodeB MO to confirm that the configuration is correct. Please generate a concise SWI-Prolog rule to perform this procedure. Include a directive at the end so that all rules are executed automatically when loaded in a Prolog environment. Name the directive at end check_create_termpGNB.

We have a known source NR DU cell (DL10DUCell1) and a known target NR DU cell (MSRBS1170LBDUCell1). For the target NR DU cell, first obtain its IP address, then retrieve its cell ID, followed by its DU Function, and finally obtain its gNBId (the target gNBId) and gNBDUID. For the source NR DU cell, obtain its IP address and cell ID, then obtain its DU Function and from DU Function we obtain its attribute which is the reference to the VLAN Port (referred to as Vport). Next, retrieve all External GNB Partner Function MOs and check whether any contains the target gNBId. If no matching External GNB Partner Function exists, create one using the gNBDUID and gNBId obtained from the target NR DU cell. In either case—whether an existing MO is found or a new one is created—configure it to reference the previously identified VLAN Port MO (VP). Please generate a concise SWI-Prolog rule to perform this procedure. Include a directive at the end so that all rules are executed automatically when loaded in a Prolog environment. Name the directive at end check_create_PartnerF.


// Check Freq. Rel.
To establish an NR frequency relation between two cells, we have a known source NR DU cell ('DL10DUCell1', first obtain the cell’s IP address) and a known target NR DU cell ('MSRBS1170LBDUCell1', first obtain the cell’s IP address), which will be used as inputs. We will separate the process into multiple steps, generating one rule per step to work together to find or create the frequency relation. This information is for reference only and will be used later in the final query step so no action now. 

The first step is to find the source NR CU Cell corresponding to the source NR DU cell. The source NR CU Cell and source NR DU Cell share the same cellLocalId attribute. Generate one executable rule for this step. 

The second step is to find the ssbFrequency of the target NR DU cell. Generate one executable rule for this step.

The third step is to check all NR frequency relations to see if anyone originate from the source NR CU Cell and have the nRFrequencyRef attribute pointing to the target NR DU cell's ssbFrequency. If no such frequency relation exists, create a new frequency relation with the correct source NR CU Cell and reference to the correct target NR DU cell's ssbFrequency. Generate one executable rule for this step. 

The NR Frequency relation exists between two cells: the known source NR DU cell ('DL10DUCell1') and the known target NR DU cell ('MSRBS1170LBDUCell1'), which should be used as inputs. Finally, please generate SWI-Prolog code for all above three steps. Name the directive at end check_create_FreqRel.


// Check Cell Rel.
The NR Cell relation exists between two cells: the known source NR DU cell ('DL10DUCell1') and the known target NR DU cell ('MSRBS1170LBDUCell1'), which should be used as inputs. To find or create the cell relation between the source cell and the target cell, let's separate the process into multiple steps, with each step generating one rule that works together to find or create the cell relation. This information is for reference only and will be used later in the final query step so no action now.  

First, we need to first obtain the source NR DU cell’s IP address, and find the source NR DU cell ID. Then, we need to find the source NR CU Cell for the source NR DU cell, where the source NR CU Cell and the source NR DU Cell share the same local ID attribute. Generate one concise and executable rule for this step but no execution.

Second, starting from the target NR DU cell, we obtain the cell’s IP address, then we obtain its DU cell ID, local cell ID, SSB frequency and corresponding gNB ID. Generate one concise and executable rule for this step but no execution.

Third, On source NR DU cell we retrieve all External GNB CUCP Functions. Among them, we identify the one that shares the same gNB ID as the target NR DU cell. Then, we locate the corresponding External NR Cell CU for the target NR DU cell — defined by both its ID and the External GNB CUCP Function ID, and sharing the same local ID as the target NR DU cell. Generate one concise and executable rule for this step but no execution.

Fourth, we retrieve all NR frequency relations originating from the source NR CU Cell, and identify the one whose NR Frequency reference corresponds to the target NR DU cell's SSB frequency. Refer this NR Frequency relation as 'A'. Generate one concise and executable rule for this step but no execution.

Take inputs from the first four steps, the fifth step is to retrieve all NR cell relations and identify the one from the source NR CU Cell to the target NR DU cell that uses the frequency relation 'A' found in the Fourth step. If such a cell relation does not exist, we create it, setting the neighbor cell reference to the External NR Cell CU of the target NR cell and frequency reference to the frequency relation 'A'. Generate one concise and executable rule for this step but no execution.

The final step is to configure the NR cell relation by setting its coverage indicator to '2' and its second cell candidate attribute to '2'. The NR cell relation is between two cells: the known source NR DU cell ('DL10DUCell1') and the known target NR DU cell ('MSRBS1170LBDUCell1'), which should be used as inputs. Finally, please generate SWI-Prolog code for all previous defined rules together. At the end of the generated Prolog code, please include a standard Prolog entry point (such as a directive) so that the code can be run directly in a Prolog environment. Please provide only the code output itself, without any explanations or formatting indicators. Name the directive at end check_create_CellRel.


// restart VDU and BB
Restart the FRU (VDU) for the CRGNB corresponding to the selected MB cell ('DL10DUCell1') using the following steps: find the cell’s IP address, retrieve all its field-replaceable units, and identify the one with an ID containing 'VDU'. Then, restart this field-replaceable unit, wait for 300 seconds and verify its operational state ('enabled'='1', 'disabled'='0'). Call the directive at end mb_finalrestart_vdu.

Restart the FRU (BB) for the MSRBS corresponding to the selected LB cell ('MSRBS1170LBDUCell1') using the following steps: find the cell’s IP address, retrieve all its field-replaceable units, and identify the one with an ID containing 'BB'. Then, restart this field-replaceable unit, wait for 300 seconds and verify its operational state ('enabled'='1', 'disabled'='0'). Call the directive at end lb_finalrestart_bb.
